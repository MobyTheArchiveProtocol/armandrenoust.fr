---
import BaseLayout from '../../layouts/BaseLayout.astro';
// 1. On importe l'outil pour récupérer nos articles
import { getCollection } from 'astro:content';

// 2. On récupère tous les articles de la collection "blog"
//    et on les trie du plus récent au plus ancien.
const posts = (await getCollection('blog')).sort(
    (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);
---

<BaseLayout title="Blog">
    <section class="page-intro">
        <h1>Le Blog : Conseils et Démystification</h1>
        <p class="subtitle">
            Ici, je partage des conseils pratiques et je démystifie le marketing digital. 
            Pas de "bullshit", juste du concret.
        </p>
    </section>

    <ul class="post-list">
        {posts.map((post) => (
            <li class="post-item">
                <a href={`/blog/${post.slug}/`}>
                    <h2>{post.data.title}</h2>
                    <p class="date">
                        Publié le: {post.data.pubDate.toLocaleDateString('fr-FR', { 
                            year: 'numeric', month: 'long', day: 'numeric' 
                        })}
                    </p>
                    <p class="desc">{post.data.description}</p>
                    <span class="read-more">Lire l'article &rarr;</span>
                </a>
            </li>
        ))}
    </ul>

</BaseLayout>

<style>
    .page-intro { text-align: center; margin-bottom: 4rem; }
    .page-intro h1 { font-size: 3rem; margin-bottom: 1rem; }
    .page-intro .subtitle { font-size: 1.2rem; color: var(--text-muted); }

    .post-list {
        list-style: none; padding: 0; margin: 0; display: grid; gap: 2rem;
    }

    .post-item a {
        display: block;
        background-color: var(--bg-card); /* Carte sombre */
        border: 1px solid var(--border-subtle);
        border-radius: 12px;
        padding: 2rem;
        text-decoration: none;
        transition: all 0.2s ease;
    }

    .post-item a:hover {
        border-color: var(--brand-color);
        transform: translateY(-3px);
    }

    .post-item h2 { font-size: 1.5rem; color: #fff; margin: 0 0 0.5rem; }
    .post-item .date { font-size: 0.9rem; color: #666; margin-bottom: 1rem; }
    .post-item .desc { font-size: 1rem; line-height: 1.6; color: #aaa; margin-bottom: 1.5rem; }
    .post-item .read-more { font-weight: 600; color: var(--brand-color); font-size: 0.9rem;}

@media (max-width: 768px) {
    .page-intro h1 { font-size: 2.5rem; }
    
    /* Moins de padding autour des cartes */
    .post-item a {
        padding: 1.5rem;
    }
}
</style>